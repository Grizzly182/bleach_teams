<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Squad Builder Pro</title>
    <style>
        :root {
            --atk-color: #ef4444; --def-color: #3b82f6; --hp-color: #10b981;
            --bg-grad: linear-gradient(180deg, #1a2a3a 0%, #050505 100%);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; font-family: 'Segoe UI', sans-serif; }
        body { background: #000; height: 100vh; overflow: hidden; color: white; }

        /* –§–æ–Ω–æ–≤–∞—è —Å—Ü–µ–Ω–∞ */
        .game-screen {
            width: 100vw; height: 100vh; background: var(--bg-grad);
            display: flex; flex-direction: column; position: relative;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .header {
            padding: 15px 30px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.5); border-bottom: 2px solid #333;
        }
        .power-counter { font-size: 24px; color: #f97316; font-weight: bold; text-shadow: 0 0 10px #f9731655; }

        /* –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–æ–π (2 —Ä—è–¥–∞ –ø–æ 3) */
        .squad-grid {
            flex: 1; display: grid; grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr); gap: 20px; padding: 40px 10%;
        }
        .main-slot {
            background: rgba(255,255,255,0.05); border: 2px dashed #444; border-radius: 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; position: relative; overflow: hidden;
        }
        .main-slot:hover { background: rgba(255,255,255,0.1); border-color: #888; }
        .main-slot.filled { border: 2px solid #fff; background: rgba(20,30,40,0.8); }

        .slot-name { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); text-align: center; padding: 5px; font-size: 14px; }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–ú–µ–Ω—é –ø–µ—Ä—Å–æ–Ω–∞–∂–∞) */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-overlay.active { display: flex; }
        .character-menu {
            background: #222; width: 90%; max-width: 800px; border: 2px solid #444;
            border-radius: 20px; display: flex; flex-direction: column; overflow: hidden;
        }
        .menu-header { padding: 15px; background: #333; display: flex; justify-content: space-between; }
        .menu-content { display: flex; padding: 20px; gap: 20px; flex-wrap: wrap; }

        /* –°–µ–∫—Ü–∏—è —É–∑ */
        .bonds-panel { flex: 1; min-width: 250px; background: #1a1a1a; padding: 15px; border-radius: 10px; }
        .bond-item { 
            display: flex; justify-content: space-between; padding: 10px; margin-bottom: 8px;
            border-radius: 5px; background: #222; border-left: 5px solid #444; opacity: 0.5;
        }
        .bond-item.active { opacity: 1; border-left-color: var(--color); background: #2a2a2a; }

        /* –°–ª–æ—Ç—ã –ø–æ–º–æ—â–∏ */
        .assist-panel { flex: 1; min-width: 250px; }
        .assist-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .assist-slot {
            aspect-ratio: 1; background: #333; border: 1px dashed #666; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 10px;
        }
        .assist-slot.filled { border: 2px solid #3b82f6; background: #1e3a8a; }

        .stars-row { display: flex; gap: 5px; margin-bottom: 15px; cursor: pointer; color: #444; font-size: 20px; }
        .star.active { color: #ffd700; }

        .btn-share { background: #f97316; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-remove { background: #991b1b; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<div class="game-screen">
    <div class="header">
        <div class="power-counter">–†–≠–ò–ê–¶–£: <span id="totalPower">0</span></div>
        <button class="btn-share" onclick="shareTeam()">üîó –ü–û–î–ï–õ–ò–¢–¨–°–Ø</button>
    </div>

    <div class="squad-grid" id="squadGrid">
        </div>
</div>

<div class="modal-overlay" id="modal">
    <div class="character-menu">
        <div class="menu-header">
            <h2 id="modalTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–µ—Ä–æ—è</h2>
            <button onclick="closeModal()" style="background:none; border:none; color:white; font-size:24px; cursor:pointer;">‚úï</button>
        </div>
        <div class="menu-content">
            <div class="bonds-panel">
                <button onclick="pickMainChar()" style="width:100%; padding:10px; margin-bottom:10px;">–°–º–µ–Ω–∏—Ç—å –≥–µ—Ä–æ—è</button>
                <div class="stars-row" id="starsRow"></div>
                <h3>–£–∑—ã (Bonuses)</h3>
                <div id="bondsList"></div>
                <button class="btn-remove" onclick="removeMainChar()">–£–±—Ä–∞—Ç—å –∏–∑ —Å—Ç—Ä–æ—è</button>
            </div>
            
            <div class="assist-panel">
                <h3>–°–ª–æ—Ç—ã –ø–æ–º–æ—â–∏ (6)</h3>
                <div class="assist-grid" id="assistGrid"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    const HEROES = {
        'ichigo': { name: '–ò—á–∏–≥–æ', color: '#f97316', bonds: { atk: 'rukia', def: 'chad', hp: 'orihime' } },
        'rukia': { name: '–†—É–∫–∏—è', color: '#3b82f6', bonds: { atk: 'renji', def: 'byakuya', hp: 'ichigo' } },
        'orihime': { name: '–û—Ä–∏—Ö–∏–º–µ', color: '#ec4899', bonds: { atk: 'ishida', def: 'ichigo', hp: 'chad' } },
        'aizen': { name: '–ê–π–∑–µ–Ω', color: '#a855f7', bonds: { atk: 'gin', def: 'tosen', hp: 'momo' } }
    };

    const STAR_BONUSES = { 1: 5, 2: 10, 3: 15, 4: 25, 5: 40, 6: 60 };

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç—Ä—è–¥–∞ (6 —Å–ª–æ—Ç–æ–≤)
    let squad = Array.from({ length: 6 }, () => ({ id: null, stars: 1, assists: Array(6).fill(null) }));
    let currentSlotIdx = null;

    function init() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('team')) {
            squad = JSON.parse(atob(urlParams.get('team')));
        }
        renderSquad();
    }

    function renderSquad() {
        const grid = document.getElementById('squadGrid');
        grid.innerHTML = '';
        squad.forEach((slot, i) => {
            const div = document.createElement('div');
            div.className = `main-slot ${slot.id ? 'filled' : ''}`;
            div.innerHTML = slot.id ? `<div class="slot-name">${HEROES[slot.id].name}</div>` : '<span>+</span>';
            div.onclick = () => openModal(i);
            grid.appendChild(div);
        });
    }

    function openModal(idx) {
        currentSlotIdx = idx;
        const slot = squad[idx];
        document.getElementById('modal').classList.add('active');
        refreshModalUI();
    }

    function refreshModalUI() {
        const slot = squad[currentSlotIdx];
        if (!slot.id) {
            document.getElementById('bondsList').innerHTML = '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–µ—Ä–æ—è';
            document.getElementById('assistGrid').innerHTML = '';
            return;
        }

        const hero = HEROES[slot.id];
        const bonus = STAR_BONUSES[slot.stars];

        // –†–µ–Ω–¥–µ—Ä –∑–≤–µ–∑–¥
        document.getElementById('starsRow').innerHTML = [1,2,3,4,5,6].map(s => 
            `<span class="star ${s <= slot.stars ? 'active' : ''}" onclick="setStars(${s})">‚òÖ</span>`
        ).join('');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∑
        const bList = document.getElementById('bondsList');
        bList.innerHTML = '';
        const types = [
            { key: 'atk', n: '–ê—Ç–∞–∫–∞', c: '#ef4444' },
            { key: 'def', n: '–î–æ—Å–ø–µ—Ö', c: '#3b82f6' },
            { key: 'hp', n: '–ó–¥–æ—Ä–æ–≤—å–µ', c: '#10b981' }
        ];

        types.forEach(t => {
            const target = hero.bonds[t.key];
            const isActive = slot.assists.includes(target);
            bList.innerHTML += `
                <div class="bond-item ${isActive ? 'active' : ''}" style="--color: ${t.c}">
                    <span>${t.n} (+${bonus}%)</span>
                    <small>${HEROES[target].name}</small>
                </div>`;
        });

        // –°–ª–æ—Ç—ã –ø–æ–º–æ—â–∏
        const aGrid = document.getElementById('assistGrid');
        aGrid.innerHTML = '';
        slot.assists.forEach((asId, ai) => {
            const aDiv = document.createElement('div');
            aDiv.className = `assist-slot ${asId ? 'filled' : ''}`;
            aDiv.innerHTML = asId ? HEROES[asId].name[0] : '+';
            aDiv.onclick = () => pickAssist(ai);
            aGrid.appendChild(aDiv);
        });
    }

    function pickMainChar() {
        const id = prompt("–í–≤–µ–¥–∏—Ç–µ id (ichigo, rukia, orihime, aizen):");
        if (HEROES[id]) { squad[currentSlotIdx].id = id; refreshModalUI(); renderSquad(); }
    }

    function pickAssist(ai) {
        const id = prompt("–ö—Ç–æ –≤ –ø–æ–º–æ—â—å? (ichigo, rukia, orihime, aizen):");
        if (HEROES[id]) { squad[currentSlotIdx].assists[ai] = id; refreshModalUI(); }
    }

    function setStars(s) { squad[currentSlotIdx].stars = s; refreshModalUI(); }
    function removeMainChar() { squad[currentSlotIdx] = { id: null, stars: 1, assists: Array(6).fill(null) }; closeModal(); renderSquad(); }
    function closeModal() { document.getElementById('modal').classList.remove('active'); }

    function shareTeam() {
        const link = window.location.origin + window.location.pathname + '?team=' + btoa(JSON.stringify(squad));
        navigator.clipboard.writeText(link);
        alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
    }

    init();
</script>

</body>
</html>